<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Dulce Recepción - Catálogo</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Dulce Recepción — Navidad</h1>
    <p>Reposteria</p>
  </header>

  <main id="catalogue"></main>

  <script>
    const API_BASE = 'https://TU_RAILWAY_API_URL' // cambiar luego
    async function loadProducts(){
      try{
        const res = await fetch(API_BASE + '/api/products')
        const products = await res.json()
        const cont = document.getElementById('catalogue')
        cont.innerHTML = products.map(p => `
          <article class="card">
            <img src="${p.image_url}" alt="${p.name}" />
            <h3>${p.name} — $${p.price}</h3>
            <p>${p.description || ''}</p>
            <div class="actions">
              <a href="https://wa.me/56930656989?text=${encodeURIComponent(`Hola, quiero pedir: ${p.name}. Cantidad:`)}" target="_blank">Pedir por WhatsApp</a>
              <button onclick="openOrderModal(${p.id})">Hacer pedido</button>
            </div>
          </article>`).join('')
      }catch(e){
        console.error(e)
        document.getElementById('catalogue').innerText = 'Error cargando catálogo.'
      }
    }
    loadProducts()
    function openOrderModal(id){
      const name = prompt('Tu nombre:')
      const phone = prompt('Teléfono:')
      const qty = prompt('Cantidad:')
      if(!name || !phone || !qty) return alert('Pedido cancelado')
      fetch(API_BASE + '/api/orders', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ customer_name: name, phone, items:[{product_id:id, quantity:parseInt(qty)}] })
      }).then(r=>r.json()).then(d=>{
        alert('Pedido recibido. ID: ' + d.orderId)
      }).catch(e=>{ alert('Error al enviar pedido') })
    }
  </script>
</body>
</html>
